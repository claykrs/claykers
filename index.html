<!DOCTYPE html>

<html>
    <title>yuan idle [v0.0.2]</title>
    <body>
        <div style="display: flex; flex-direction: column;">
            <h1 id="yuan">0 Â¥</h1>
            <h3 id="output">+1 Â¥/s</h3>
            <button id="rebirth" disabled="true"></button>
            <button id="rebirth_s" disabled="true">ðŸ›’</button> 
            <div id="_upgrade_container"></div>
            <div id="yin_boost_container" style="
                padding: 10px;
                visibility: hidden;
                background-color: rgba(239,239,239, 0.3);
                border-radius: 1px;
                border: gray;
                font-family: sans-serif;
                overflow-y: auto;
                height: 100%;
            " >
                <p id="yin_available"></p>
            </div>
        </div>
    </body>

    <style>
        #yuan {
            margin-top: 0;
            margin-bottom: 4px;
        }

        #output {
            margin-top: 0;
            color: #111111;
            font-style: italic;
            font-weight: normal;
        }

        #rebirth {
            font-size: 14px;
            height: 30px;
            width: 300px;
         
            position: fixed;
            bottom: 30px;
            right: 45%;

            color: gray;
        }

        #rebirth_s {
            font-size: 14px;
            height: 30px;
            width: 50px;
            
            line-height: 50%;
            position: fixed;
            bottom: 30px;
            right: 42%;
        }

        #_upgrade_container {
            position: fixed;
            top: 36px;
            right: 1px;
            width: 320px;
            height: 91vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            padding: 5px;
        }
    </style>

    <script>      
        let idleT =
            Date.now()
        
        const template = {
            "yuan": 0,
            "yuanx": 0,

            "yin": 0,
            "has_rebirth": false,
            
            "_idle_output": 1,
            "_idle_rate": 1000,

            "upgrades": [
                { "price": 1E3, "owned": [0, 10], 
                    "value": [-50, "_idle_rate"], "mul": 10},

                { "price": 25, "owned": [0, 100], "value": [1, "_idle_output"] },
                { "price": 125, "owned": [0, 100], "value": [5, "_idle_output"] },
                { "price": 625, "owned": [0, 100], "value": [25, "_idle_output"] },
                { "price": 3_250, "owned": [0, 100], "value": [125, "_idle_output"] },
                { "price": 15_625, "owned": [0, 100], "value": [625, "_idle_output"] },
                { "price": 78_125, "owned": [0, 100], "value": [3_125, "_idle_output"] },
                { "price": 390_625, "owned": [0, 100], "value": [15_625, "_idle_output"] },
                { "price": 1_953_125, "owned": [0, 100], "value": [78_125, "_idle_output"] },
                { "price": 9_765_625, "owned": [0, 100], "value": [390_625, "_idle_output"] },
                { "price": 48_828_125, "owned": [0, 100], "value": [1_953_125, "_idle_output"] },
                { "price": 244_140_625, "owned": [0, 100], "value": [9_765_625, "_idle_output"] },
                { "price": 1_220_703_125, "owned": [0, 100], "value": [48_828_125, "_idle_output"] },
                { "price": 6_103_515_625, "owned": [0, 100], "value": [244_140_625, "_idle_output"] },
                { "price": 30_517_578_125, "owned": [0, 100], "value": [1_220_703_125, "_idle_output"] },
                { "price": 152_587_890_625, "owned": [0, 100], "value": [6_103_515_625, "_idle_output"] },
                { "price": 762_939_453_125, "owned": [0, 100], "value": [30_517_578_125, "_idle_output"] },
                { "price": 3_814_697_265_625, "owned": [0, 100], "value": [152_587_890_625, "_idle_output"] },
                { "price": 19_073_486_328_125, "owned": [0, 100], "value": [762_939_453_125, "_idle_output"] },
                { "price": 95_367_431_640_625, "owned": [0, 100], "value": [3_814_697_265_625, "_idle_output"] },
                { "price": 476_837_158_203_125, "owned": [0, 100], "value": [19_073_486_328_125, "_idle_output"] },
                { "price": 2_384_185_791_015_625, "owned": [0, 100], "value": [95_367_431_640_625, "_idle_output"] },
                { "price": 11_920_928_955_078_125, "owned": [0, 100], "value": [476_837_158_203_125, "_idle_output"] },
                { "price": 59_604_644_775_390_625, "owned": [0, 100], "value": [2_384_185_791_015_625, "_idle_output"] },
                { "price": 298_023_223_876_953_125, "owned": [0, 100], "value": [11_920_928_955_078_125, "_idle_output"] },
                { "price": 1_490_116_119_384_765_625, "owned": [0, 100], "value": [59_604_644_775_390_625, "_idle_output"] },
                { "price": 7_450_580_596_923_828_125, "owned": [0, 100], "value": [298_023_223_876_953_125, "_idle_output"] },
                { "price": 37_252_902_984_619_140_625, "owned": [0, 100], "value": [1_490_116_119_384_765_625, "_idle_output"] },
                { "price": 186_264_514_923_095_703_125, "owned": [0, 100], "value": [7_450_580_596_923_828_125, "_idle_output"] },
                { "price": 931_322_574_615_478_515_625, "owned": [0, 100], "value": [37_252_902_984_619_140_625, "_idle_output"] },
                { "price": 4_656_612_873_077_392_578_125, "owned": [0, 100], "value": [186_264_514_923_095_703_125, "_idle_output"] },
                { "price": 23_283_064_365_386_962_890_625, "owned": [0, 100], "value": [931_322_574_615_478_515_625, "_idle_output"] },
                { "price": 116_415_321_826_934_814_453_125, "owned": [0, 100], "value": [4_656_612_873_077_392_578_125, "_idle_output"] },
                { "price": 582_076_609_134_674_072_265_625, "owned": [0, 100], "value": [23_283_064_365_386_962_890_625, "_idle_output"] },
                { "price": 2_910_383_045_673_370_361_328_125, "owned": [0, 100], "value": [116_415_321_826_934_814_453_125, "_idle_output"] },
                { "price": 14_551_915_228_366_851_806_640_625, "owned": [0, 100], "value": [582_076_609_134_674_072_265_625, "_idle_output"] },
                { "price": 72_759_576_141_834_259_033_203_125, "owned": [0, 100], "value": [2_910_383_045_673_370_361_328_125, "_idle_output"] },
                { "price": 363_797_880_709_171_295_166_015_625, "owned": [0, 100], "value": [14_551_915_228_366_851_806_640_625, "_idle_output"] },
                { "price": 1_818_989_403_545_856_475_830_078_125, "owned": [0, 100], "value": [72_759_576_141_834_259_033_203_125, "_idle_output"] },
                { "price": 9_094_947_017_729_282_379_150_390_625, "owned": [0, 100], "value": [363_797_880_709_171_295_166_015_625, "_idle_output"] },
                { "price": 45_474_735_088_646_411_895_751_953_125, "owned": [0, 100], "value": [1_818_989_403_545_856_475_830_078_125, "_idle_output"] },
                { "price": 227_373_675_443_232_059_478_759_765_625, "owned": [0, 100], "value": [9_094_947_017_729_282_379_150_390_625, "_idle_output"] },
                { "price": 1_136_868_377_216_160_297_393_798_828_125, "owned": [0, 100], "value": [45_474_735_088_646_411_895_751_953_125, "_idle_output"] },
                { "price": 5_684_341_886_080_801_486_968_914_140_625, "owned": [0, 100], "value": [227_373_675_443_232_059_478_759_765_625, "_idle_output"] },
                { "price": 28_421_709_430_404_007_434_844_570_703_125, "owned": [0, 100], "value": [1_136_868_377_216_160_297_393_798_828_125, "_idle_output"] },
                { "price": 142_108_547_152_020_037_174_222_853_515_625, "owned": [0, 100], "value": [5_684_341_886_080_801_486_968_914_140_625, "_idle_output"] },
                { "price": 710_542_735_760_100_185_871_114_267_578_125, "owned": [0, 100], "value": [28_421_709_430_404_007_434_844_570_703_125, "_idle_output"] },
                { "price": 3_552_713_678_000_500_929_355_637_890_625, "owned": [0, 100], "value": [142_108_547_152_020_037_174_222_853_515_625, "_idle_output"] },
                { "price": 17_763_568_390_002_504_646_778_189_453_125, "owned": [0, 100], "value": [710_542_735_760_100_185_871_114_267_578_125, "_idle_output"] },
                { "price": 88_817_841_950_012_523_233_890_947_265_625, "owned": [0, 100], "value": [3_552_713_678_000_500_929_355_637_890_625, "_idle_output"] },
                { "price": 444_089_209_750_062_616_169_454_736_328_125, "owned": [0, 100], "value": [17_763_568_390_002_504_646_778_189_453_125, "_idle_output"] },
                { "price": 2_220_446_048_750_313_080_847_273_681_640_625, "owned": [0, 100], "value": [88_817_841_950_012_523_233_890_947_265_625, "_idle_output"] },
                { "price": 11_102_230_243_751_565_404_236_368_408_203_125, "owned": [0, 100], "value": [444_089_209_750_062_616_169_454_736_328_125, "_idle_output"] },
                { "price": 55_511_151_218_757_827_021_181_842_041_015_625, "owned": [0, 100], "value": [2_220_446_048_750_313_080_847_273_681_640_625, "_idle_output"] },
                { "price": 277_555_756_093_789_135_105_909_210_205_078_125, "owned": [0, 100], "value": [11_102_230_243_751_565_404_236_368_408_203_125, "_idle_output"] },
                { "price": 1_387_778_780_468_945_675_529_460_025_390_625, "owned": [0, 100], "value": [55_511_151_218_757_827_021_181_842_041_015_625, "_idle_output"] },
                { "price": 6_938_893_902_344_728_377_647_300_126_953_125, "owned": [0, 100], "value": [277_555_756_093_789_135_105_909_210_205_078_125, "_idle_output"] },
                { "price": 34_694_469_511_723_641_888_236_500_634_765_625, "owned": [0, 100], "value": [1_387_778_780_468_945_675_529_460_025_390_625, "_idle_output"] },
                { "price": 173_472_347_558_618_209_441_182_503_173_828_125, "owned": [0, 100], "value": [6_938_893_902_344_728_377_647_300_126_953_125, "_idle_output"] },
                { "price": 867_361_737_793_091_047_205_912_515_869_140_625, "owned": [0, 100], "value": [34_694_469_511_723_641_888_236_500_634_765_625, "_idle_output"] },
                { "price": 4_336_808_688_965_455_236_029_562_579_345_703_125, "owned": [0, 100], "value": [173_472_347_558_618_209_441_182_503_173_828_125, "_idle_output"] },
                { "price": 21_684_043_444_827_276_180_147_812_896_728_515_625, "owned": [0, 100], "value": [867_361_737_793_091_047_205_912_515_869_140_625, "_idle_output"] },
                { "price": 108_420_217_224_136_380_900_739_064_483_642_578_125, "owned": [0, 100], "value": [4_336_808_688_965_455_236_029_562_579_345_703_125, "_idle_output"] },
                { "price": 542_101_086_120_681_904_503_695_322_418_212_890_625, "owned": [0, 100], "value": [21_684_043_444_827_276_180_147_812_896_728_515_625, "_idle_output"] },
                { "price": 2_710_505_430_603_409_522_518_476_611_091_453_125_000, "owned": [0, 100], "value": [108_420_217_224_136_380_900_739_064_483_642_578_125, "_idle_output"] },
                { "price": 13_552_527_153_017_047_612_592_383_055_457_265_625_000, "owned": [0, 100], "value": [542_101_086_120_681_904_503_695_322_418_212_890_625, "_idle_output"] },
                { "price": 67_762_635_765_085_238_062_961_915_277_286_328_125_000, "owned": [0, 100], "value": [2_710_505_430_603_409_522_518_476_611_091_453_125_000, "_idle_output"] },
                { "price": 338_813_178_825_426_190_314_809_576_386_431_640_625_000, "owned": [0, 100], "value": [13_552_527_153_017_047_612_592_383_055_457_265_625_000, "_idle_output"] },
                { "price": 1_694_065_894_127_130_951_574_047_881_932_158_203_125_000, "owned": [0, 100], "value": [67_762_635_765_085_238_062_961_915_277_286_328_125_000, "_idle_output"] },
                { "price": 8_470_329_470_635_654_757_870_239_409_660_791_015_625_000, "owned": [0, 100], "value": [338_813_178_825_426_190_314_809_576_386_431_640_625_000, "_idle_output"] },
                { "price": 42_351_647_353_178_273_789_351_197_048_303_955_078_125_000, "owned": [0, 100], "value": [1_694_065_894_127_130_951_574_047_881_932_158_203_125_000, "_idle_output"] },
                { "price": 211_758_236_765_891_368_946_755_985_241_519_775_390_625_000, "owned": [0, 100], "value": [8_470_329_470_635_654_757_870_239_409_660_791_015_625_000, "_idle_output"] },
                { "price": 1_058_791_183_829_456_844_733_779_926_207_598_876_953_125_000, "owned": [0, 100], "value": [42_351_647_353_178_273_789_351_197_048_303_955_078_125_000, "_idle_output"] },
                { "price": 5_293_955_919_147_284_223_668_899_631_037_994_384_765_625_000, "owned": [0, 100], "value": [211_758_236_765_891_368_946_755_985_241_519_775_390_625_000, "_idle_output"] },
                { "price": 26_469_779_595_736_421_118_344_498_155_189_971_923_828_125_000, "owned": [0, 100], "value": [1_058_791_183_829_456_844_733_779_926_207_598_876_953_125_000, "_idle_output"] },
                { "price": 132_348_897_978_682_105_591_722_490_775_949_859_619_140_625_000, "owned": [0, 100], "value": [5_293_955_919_147_284_223_668_899_631_037_994_384_765_625_000, "_idle_output"] },
                { "price": 661_744_489_893_410_527_958_612_453_879_749_298_095_703_125_000, "owned": [0, 100], "value": [26_469_779_595_736_421_118_344_498_155_189_971_923_828_125_000, "_idle_output"] },
                { "price": 3_308_722_449_467_052_639_793_062_269_398_746_490_478_515_625_000, "owned": [0, 100], "value": [132_348_897_978_682_105_591_722_490_775_949_859_619_140_625_000, "_idle_output"] },
                { "price": 16_543_612_247_335_263_198_965_311_346_993_732_452_392_578_125_000, "owned": [0, 100], "value": [661_744_489_893_410_527_958_612_453_879_749_298_095_703_125_000, "_idle_output"] },
                { "price": 82_718_061_236_676_315_994_826_556_734_968_662_261_962_890_625_000, "owned": [0, 100], "value": [3_308_722_449_467_052_639_793_062_269_398_746_490_478_515_625_000, "_idle_output"] },
                { "price": 413_590_306_183_381_579_974_132_783_674_843_311_309_814_453_125_000, "owned": [0, 100], "value": [16_543_612_247_335_263_198_965_311_346_993_732_452_392_578_125_000, "_idle_output"] },
                { "price": 2_067_951_530_916_907_899_870_663_918_374_216_556_549_072_265_625_000, "owned": [0, 100], "value": [82_718_061_236_676_315_994_826_556_734_968_662_261_962_890_625_000, "_idle_output"] }

            ]
        }

        function deep(arr) {
            return structuredClone(arr) }
        template.yin_boosts = Array(template.upgrades.length).fill(0)
        let data = deep(template)

        function openYinShop() {
            const container = document.getElementById("yin_boost_container")
            
            document.getElementById("yin_available").textContent = 
                `You have ${F(data.yin)} â˜¯`

            const oldRows = container.querySelectorAll(".yin_boost_row")
            oldRows.forEach(row => row.remove())

            data.upgrades.forEach((upg, i) => {
                let row = document.createElement("div")
                row.className = "yin_boost_row"
                row.style.marginBottom = "12px"

                let boostCount = data.yin_boosts[i]
                let boostMult = 1 + 0.05 * boostCount
                let newValue = upg.value[0] * boostMult
                let cost = (boostCount + 1) * 5

                row.innerHTML = `
                    <b>Upgrade ${i + 1}</b>: +${F(newValue)}${name(upg.value[1])}
                    <br>Boosts: ${boostCount}/5 
                    ${boostCount < 5 ? `| Cost: ${cost} â˜¯` : '| Maxed'}
                `

                if (boostCount < 5) {
                    let btn = document.createElement("button")
                    btn.textContent = "+ Boost"
                    btn.style.marginLeft = "10px"
                    btn.onclick = () => {
                        if (data.yin >= cost) {
                            data.yin -= cost
                            data.yin_boosts[i]++
                            openYinShop()
                        }
                    }
                    row.appendChild(btn)
                }

                container.appendChild(row)
            })
        }

        function name(k) {
            return (k == "_idle_output" && " Â¥/step" || 
                    (k == "_idle_rate" && " ms/step"))
        }

        function F(n) {
            const suffixes = [
                "", "thousand", "million", "billion", "trillion",
                "quadrillion", "quintillion", "sextillion", "septillion", "octillion", "nonillion",
                "decillion", "undecillion", "duodecillion", "tredecillion", "quattuordecillion",
                "quindecillion", "sexdecillion", "septendecillion", "octodecillion", "novemdecillion",
                "vigintillion", "unvigintillion", "duovigintillion", "trevigintillion", "quattuorvigintillion",
                "quinvigintillion", "sexvigintillion", "septenvigintillion", "octovigintillion", "novemvigintillion",
                "trigintillion", "untrigintillion", "duotrigintillion", "googol"
            ]

            const abs = Math.abs(n)
            if (abs >= 1E3 && abs < 1E6) {
                return n.toLocaleString(undefined, {
                    maximumFractionDigits: Number.isInteger(n) ? 0 : 2
                })
            }

            if (abs >= 1E6) {
                let i = 0, value = n
                while (Math.abs(value) >= 1E3
                    && i < suffixes.length - 1)
                {
                    value /= 1E3
                    i++
                }

                return value.toFixed(
                    Number.isInteger(value) ? 0 : 2)
                    + " " + suffixes[i]
            }

            return Number.isInteger(n)
                ? n.toString() : n.toFixed(2)
        }
        
        function N(n) {
            return Number((n).toFixed(2))
        }

        function maxBuy(upg) {
        let maxCanBuy = upg.owned[1] - upg.owned[0]
        let affordableCount = 0;
        let price = upg.price;
        let totalCost = 0;
        const mul = upg.mul || 1.15;

        for (let i = 0; i < maxCanBuy; i++) {
            if (totalCost + price > data.yuan) break;
            totalCost += price;
            price = Math.floor(price * mul);
            affordableCount++;
        }
            return { affordableCount, totalCost };
        }

        data.upgrades.forEach((upg, i) => {            
            let button = document.createElement("button")
            button.style.fontSize = "14px"; 
            button.style.height = "50px"
            button.style.width = "280px"
            button.id = `upg_${i+1}`
            
            button.innerHTML = `upgrade ${i+1} (${upg.owned[0]})`
                + `<br>+${F(upg.value[0])}${name(upg.value[1])}`
                  +`<br>-${F(upg.price)} Â¥`
            
            let container = document.getElementById("_upgrade_container")
                container.appendChild(button)
            container.appendChild(document.createElement("div"))

            button.onclick = function() {
                let upg = data.upgrades[i];
                if (upg.owned[0] >= upg.owned[1]) {
                    return
                }

                let { affordableCount, totalCost } = maxBuy(upg);
                if (affordableCount === 0) return;

                data.yuan -= totalCost;
                upg.owned[0] += affordableCount;
                data[upg.value[1]] += upg.value[0] * affordableCount;

                for (let j = 0; j < affordableCount; j++) {
                    upg.price = Math.floor(upg.price * (upg.mul || 1.15));
                }
            }
        })
        
        setInterval(function() {
            let content = `${F(data.yuan)} Â¥`
            if (data.yuanx > 1) {
                content += ` (${F(data.yuanx)}x mul)` }
            document.getElementById("yuan").textContent =  content
            document.getElementById("output").textContent = 
                `+${F(data._idle_output)} Â¥/step (${data._idle_rate >= 1E3 
                    && `${data._idle_rate / 1E3}s` || data._idle_rate + "ms"})`

            let rebirth = document.getElementById("rebirth")
            let text = "you cannot rebirth (1 million Â¥ required)"
            let yin = Math.floor(Math.cbrt(data.yuan / 1E6))
            let mul = N(Math.log10(data.yuan / 1E5))

            if (data.yuan >= 1E6 && yin > 0) {
                text = `rebirth for (+${F(yin)} â˜¯, +${F(mul)}x Â¥)`
                rebirth.disabled = false
                rebirth.style.color = "black"
            } else {
                rebirth.disabled = true
                rebirth.style.color = "gray"}
            if (rebirth.innerHTML != text) {
                rebirth.innerHTML = text
            }

            if (!rebirth.onclick) {
                rebirth.onclick = function() {
                    let yinG = Math.floor(Math.cbrt(data.yuan / 1E6))
                    let mulG = (Math.log10(data.yuan / 1E5))
                    
                    let yuanx = data.yuanx
                    let yin = data.yin
                    let upg = deep(data.yin_upgrades)

                    data = deep(template)
                    data.has_rebirth = true
                    data.yin = N(yin + yinG)
                    data.yuanx = N(yuanx + mulG)
                    data.yin_upgrades = upg
                }
            }

            data.upgrades.forEach((upg, i) => {
                let button = document.getElementById(`upg_${i+1}`)
                
                button.innerHTML = 
                    `${upg.value[0] > 0 && "+" || ""}`
                    + `${F(upg.value[0])}${name(upg.value[1])}`
                    + ` (${upg.owned[0] >= upg.owned[1] && "max"
                        || upg.owned[0] + "/" + upg.owned[1]})`
                      +`<br>cost ${F(upg.price)} Â¥`

                if (data.yuan >= upg.price) {
                    button.disabled = false
                    button.style.color = "black"
                } else {
                    button.disabled = true
                    button.style.color = "gray"
                }

                if (upg.owned[0] >= upg.owned[1]) {
                    button.disabled = true
                    button.style.color = "gray"
                }
            })

            let now = Date.now()
            let steps = Math.floor(((now - idleT)
                / 1E3 * 1E3) / data._idle_rate)

            if (steps > 0) {
                let mul = data.yuanx > 1 && data.yuanx || 1
                data.yuan += N((steps * data._idle_output) * mul)
                idleT += steps * data._idle_rate
            }
        }, 10)

        document.addEventListener("visibilitychange", () => {
            if (!document.hidden) {
                idleT = Date.now()
            }
        })
    </script>
</html>
